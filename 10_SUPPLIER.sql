CREATE DATABASE SUPPLIER;
USE SUPPLIER;

CREATE TABLE SUPPLIERS(SID INT,SNAME VARCHAR(10),ADDRESS VARCHAR(10),PRIMARY KEY(SID));

CREATE TABLE PARTS(PID INT,PNAME VARCHAR(10),COLOR VARCHAR(10),PRIMARY KEY(PID));

CREATE TABLE CATALOG(SID INT,PID INT,COST REAL,PRIMARY KEY(SID,PID),FOREIGN KEY(SID) REFERENCES SUPPLIERS(SID),FOREIGN KEY(PID) REFERENCES PARTS(PID));

INSERT INTO SUPPLIERS VALUES(10,'ACMEWIDGET','BLORE');
INSERT INTO SUPPLIERS VALUES(20,'JONES','DELHI');
INSERT INTO SUPPLIERS VALUES(30,'VIMAL','PUNE');
INSERT INTO SUPPLIERS VALUES(40,'RELIANCE','MUMBAI');
INSERT INTO SUPPLIERS VALUES(50,'PARCEL','KOLKATA');
SELECT * FROM SUPPLIERS;

INSERT INTO PARTS VALUES(100,'BOOK','RED');
INSERT INTO PARTS VALUES(200,'PEN','RED');
INSERT INTO PARTS VALUES(300,'PENCIL','GREEN');
INSERT INTO PARTS VALUES(400,'MOBILE','GREEN');
INSERT INTO PARTS VALUES(500,'CHARGER','BLACK');
INSERT INTO PARTS VALUES(600,'ERASER','WHITE');
SELECT * FROM PARTS;

INSERT INTO CATALOG VALUES(10,100,300);
INSERT INTO CATALOG VALUES(10,200,100);
INSERT INTO CATALOG VALUES(10,300,50);
INSERT INTO CATALOG VALUES(10,400,10);
INSERT INTO CATALOG VALUES(10,500,400);
INSERT INTO CATALOG VALUES(10,600,40);
INSERT INTO CATALOG VALUES(20,100,100);
INSERT INTO CATALOG VALUES(30,200,150);
INSERT INTO CATALOG VALUES(40,300,200);
INSERT INTO CATALOG VALUES(50,400,70);
INSERT INTO CATALOG VALUES(20,500,100);
INSERT INTO CATALOG VALUES(20,200,500);
SELECT * FROM CATALOG;

/*Find the pnames of parts for which there is some supplier.*/
SELECT DISTINCT P.PNAME FROM PARTS P,CATALOG C WHERE P.PID=C.PID;

/*Find the snames of suppliers who supply every part.*/
SELECT S.SNAME FROM SUPPLIERS S WHERE NOT EXISTS (SELECT P.PID FROM PARTS P WHERE P.PID NOT IN (SELECT C.PID FROM CATALOG C WHERE C.SID=S.SID));

/*Find the snames of suppliers who supply every red part.*/
SELECT S.SNAME FROM SUPPLIERS S WHERE NOT EXISTS (SELECT P.PID FROM PARTS P WHERE P.PID NOT IN (SELECT C.PID FROM CATALOG C WHERE C.SID=S.SID) AND P.COLOR="RED");

/*Find the pnames of parts supplied by Acme Widget Suppliers and by no one else*/
SELECT P.PNAME FROM PARTS P,SUPPLIERS S,CATALOG C WHERE P.PID=C.PID AND C.SID=S.SID AND P.PNAME NOT IN (SELECT DISTINCT P.PNAME FROM PARTS P,CATALOG C,SUPPLIERS S WHERE P.PID=C.PID AND C.SID=S.SID AND S.SNAME!='ACMEWIDGET');

/*Find the sids of suppliers who charge more for some part than the average cost of that part (averaged over all the suppliers who supply that part).*/
SELECT C1.SID,C1.PID,C1.COST FROM CATALOG C1 WHERE C1.COST>(SELECT AVG(C.COST) FROM CATALOG C WHERE C.PID=C1.PID GROUP BY C.PID);

/*For each part, find the sname of the supplier who charges the most for that part.*/
SELECT S.SNAME,C.PID FROM CATALOG C,SUPPLIERS S,PARTS P WHERE S.SID=C.SID AND P.PID=C.PID AND C.COST=(SELECT MAX(C1.COST) FROM CATALOG C1 WHERE C1.PID=C.PID GROUP BY C1.PID);